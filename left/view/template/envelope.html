{{ template "layout/default" . }}
{{ define "content" }}
{{ $hasAttachments := ne (len .Envelope.Attachments) 0 }}
<h1 class="title">Envelope</h1>
<div class="columns">
  <div class="column">
    <table class="table">
      <tbody>
        <tr>
          <td><b>ID</b></td>
          <td>{{ .Envelope.Message.ID }}</td>
        </tr>
        <tr>
          <td><b>Received Date</b></td>
          <td>{{ dateFormat .Envelope.Message.CreatedAt }}</td>
        </tr>
        <tr>
          <td><b>Date</b></td>
          <td>{{ dateFormat .Envelope.Message.Date }}</td>
        </tr>
        <tr>
          <td><b>Subject</b></td>
          <td>{{ .Envelope.Message.Subject }}</td>
        </tr>
        <tr>
          <td><b>From</b></td>
          <td>{{ .Envelope.Message.From }}</td>
        </tr>
        {{ range $to, $ := .Envelope.Message.To }}
        <tr>
          <td><b>To</b></td>
          <td>{{ $to }}</td>
        </tr>
        {{ end }}
      </tbody>
    </table>
    <div class="buttons">
      <a class="button is-danger" href="?action=delete">
        Delete
      </a>
    </div>
  </div>
  <div class="column">
    <form action="{{ envelopeSendLink .Envelope }}" method="POST" id="endpointForm">
      <div class="field">
        <label class="label">Endpoint</label>
        <div class="control">
          <div class="select">
            <select name="endpoint" form="endpointForm">
              {{ range $end := .Endpoints }}
              <option>{{ $end.Name }}</option>
              {{ end }}
            </select>
          </div>
        </div>
      </div>
      <div class="field">
        <label class="checkbox">
          <input type="checkbox" name="no attachments">
          No Attachments
        </label>
      </div>
      <div class="field">
        <label class="checkbox">
          <input type="checkbox" name="no text">
          No Text
        </label>
      </div>
      <div class="field">
        <div class="control">
          <button class="button is-link">Send</button>
        </div>
      </div>
    </form>
  </div>
</div>
<div class="tabs is-boxed" id="tab">
  <ul>
    <li {{ if or (eq .Tab "text" ) (eq .Tab "" ) }} class="is-active" {{ end }}>
      <a href='{{ tabQuery "text" }}'>
        <span>Text</span>
      </a>
    </li>
    {{ if .Envelope.Message.HTML }}
    <li>
      <a href="{{ envelopeHTMLLink .Envelope }}">
        <span>HTML</span>
      </a>
    </li>
    {{ end }}
    {{ if $hasAttachments }}
    <li {{ if eq .Tab "attachments" }} class="is-active" {{ end }}>
      <a href='{{ tabQuery "attachments" }}'>
        <span class="mr-2">Attachments</span>
        <span class="tag is-info">{{ len .Envelope.Attachments }}</span>
      </a>
    </li>
    {{ end }}
  </ul>
</div>
{{ if or (eq .Tab "text") (eq .Tab "") }}
<pre>{{ .Envelope.Message.Text }}</pre>
{{ else if and (eq .Tab "attachments" ) $hasAttachments }}
{{ range $att := .Envelope.Attachments }}
<div class="columns is-multiline">
  {{ $href := dataLinkAttachment $att }}
  <div class="column is-4">
    <div class="card">
      {{ if $att.IsImage }}
      <div class="card-image">
        <figure class="image is-16by9">
          <img src="{{ $href }}" alt="{{ $att.Name }}">
        </figure>
      </div>
      {{ end }}
      <div class="card-content">
        <div class="is-clipped">
          <a href="{{ $href }}">{{ $att.Name }}</a>
        </div>
      </div>
    </div>
  </div>
</div>
{{ end }}
{{ end }}
{{ end }}