{{template "partials/header" .}}

<main class="container">
  <article>
    <h2>Recent Envelopes</h2>
    <figure>
      {{block "recent-envelopes-table" .}}
      <table hx-trigger="every 5s, deletedEnvelopes from:body, trimmed from:body" hx-get="/index/recent-envelopes-table"
        hx-swap="outerHTML">
        <tbody>
          {{range $val := .Messages}}
          <tr>
            <td class="text-left">
              <a href="/envelopes/{{$val.ID}}">{{$val.Subject}}</a>
            </td>
            <td class="text-right">
              <a href="/envelopes/{{$val.ID}}" title="{{timeFormat $val.CreatedAt}}">
                {{timeHumanize $val.CreatedAt}}
              </a>
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
      {{end}}
    </figure>
  </article>

  <article>
    <h2>Storage</h2>
    <figure>
      {{block "storage-table" .}}
      <table hx-trigger="every 5s, vacuumed from:body, trimmed from:body, deletedEnvelopes from:body"
        hx-get="/index/storage-table" hx-swap="outerHTML">
        <tbody>
          <tr>
            <th scope="row"><strong>Envelope Count</strong></th>
            <td>{{.Storage.EnvelopeCount}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Attachment Count</strong></th>
            <td>{{.Storage.AttachmentCount}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Attachment Size</strong></th>
            <td>{{bytesHumanize .Storage.AttachmentSize}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Database Size</strong></th>
            <td>{{bytesHumanize .Storage.DatabaseSize}}</td>
          </tr>
        </tbody>
      </table>
      {{end}}
    </figure>
    <div class="grid">
      <form method="post" action="/vacuum" hx-post="/vacuum" class="pico-form-reset">
        {{csrf $}}
        <button data-loading-path="/vacuum" data-loading-disable data-loading-aria-busy
          title="Rebuild database file to take the minimal amount of disk space.">
          Vacuum Database
        </button>
      </form>
      <form method="post" action="/trim" hx-post="/trim" class="pico-form-reset">
        {{csrf $}}
        <button hx-post="/trim" data-loading-path="/trim" data-loading-disable data-loading-aria-busy
          title="Apply retention policy against data.">
          Run Retention Policy
        </button>
      </form>
      <button hx-delete="/envelopes" data-loading-path="/envelopes" data-loading-disable data-loading-aria-busy
        hx-confirm="Are you sure you wish to delete all envelopes?" class="contrast">
        Delete Envelopes
      </button>
    </div>
  </article>

  <article>
    <h2>Retention Policy</h2>
    <figure>
      <table>
        <tbody>
          <tr>
            <th scope="row">
              <strong>
                Minimum Age
              </strong>
            </th>
            <td>{{.RetentionPolicy.MinAge}}</td>
          </tr>
          {{if not (eq .RetentionPolicy.EnvelopeCount nil)}}
          <tr>
            <th scope="row"><strong>Total Envelope Count</strong></th>
            <td>{{.RetentionPolicy.EnvelopeCount}}</td>
          </tr>
          {{end}}
          {{if not (eq .RetentionPolicy.EnvelopeAge nil)}}
          <tr>
            <th scope="row"><strong>Maximum Envelope Age</strong></th>
            <td>{{.RetentionPolicy.EnvelopeAge}}</td>
          </tr>
          {{end}}
          {{if not (eq .RetentionPolicy.AttachmentSize nil)}}
          <tr>
            <th scope="row"><strong>Total Attachment Size</strong></th>
            <td>{{bytesHumanize .RetentionPolicy.AttachmentSize}}</td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </figure>
  </article>

  <article>
    <h2>Build</h2>
    <figure>
      <table>
        <tbody>
          <tr>
            <th scope="row"><strong>Built By</strong></th>
            <td>{{build.BuiltBy}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Commit</strong></th>
            <td>
              <a href="{{build.CommitURL}}">{{build.Commit}}</a>
            </td>
          </tr>
          <tr>
            <th scope="row"><strong>Date</strong></th>
            <td>{{build.Date}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Version</strong></th>
            <td>
              <a href="{{build.ReleaseURL}}">{{build.Version}}</a>
            </td>
          </tr>
        </tbody>
      </table>
    </figure>
  </article>
</main>

{{template "partials/footer" .}}
