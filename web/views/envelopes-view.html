{{template "p/header" .}}

<main class="container">
  <nav aria-label="breadcrumb">
    <ul>
      <li><a href="/envelopes">Envelopes</a></li>
      <li>
        <a href="/envelopes/{{.Envelope.Message.ID}}">{{.Envelope.Message.ID}}</a>
      </li>
    </ul>
  </nav>

  <section>
    <h2>Message</h2>
    <figure>
      <table>
        <tbody>
          <tr>
            <th scope="row"><strong>ID</strong></th>
            <td>{{.Envelope.Message.ID}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Received Date</strong></th>
            <td>{{timeFormat .Envelope.Message.CreatedAt}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Date</strong></th>
            <td>{{timeFormat .Envelope.Message.Date}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>Subject</strong></th>
            <td>{{.Envelope.Message.Subject}}</td>
          </tr>
          <tr>
            <th scope="row"><strong>From</strong></th>
            <td>{{.Envelope.Message.From}}</td>
          </tr>
          {{range $val := .Envelope.Message.To}}
          <tr>
            <th scope="row"><strong>To</strong></th>
            <td>{{$val}}</td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </figure>

    <button class="contrast" hx-delete="/envelopes/{{.Envelope.Message.ID}}"
      hx-confirm="Are you sure you wish to delete this envelope?">
      Delete Envelope
    </button>
  </section>

  {{if .Envelope.Attachments}}
  <section>
    <h2>Attachments</h2>
    <figure>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Mime</th>
          </tr>
        </thead>
        <tbody>
          {{range $val := .Envelope.Attachments}}
          <tr>
            <td>
              <a href="/files/{{$val.FileName}}">{{$val.ID}}</a>
            </td>
            <td>
              <a href="/files/{{$val.FileName}}">{{$val.Name}}</a>
            </td>
            <td>
              <a href="/files/{{$val.FileName}}">{{$val.Mime}}</a>
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </figure>
  </section>
  {{end}}

  <section>
    <h2>Test Endpoint</h2>
    <form method="post" action="/send" hx-post="/send">
      <input type="hidden" id="envelope" name="envelope" value="{{.Envelope.Message.ID}}">
      <label for="endpoint">
        Endpoints
        <select id="endpoint" name="endpoint">
          {{range $val := .Endpoints}}
          <option value="{{$val.ID}}">{{$val.Name}}</option>
          {{end}}
        </select>
      </label>
      <button type="submit" data-loading-disable data-loading-aria-busy>Send</button>
    </form>
  </section>

  {{if .Envelope.Message.Text}}
  <section>
    <h2>Text</h2>
    <pre>{{.Envelope.Message.Text}}</pre>
  </section>
  {{end}} {{if .Envelope.Message.HTML}}
  <section>
    <h2>HTML</h2>
    <iframe style="width: 100%; height: 100vh" src="/envelopes/{{.Envelope.Message.ID}}/html">
    </iframe>
  </section>
  {{end}}

</main>

{{template "p/footer" .}}
